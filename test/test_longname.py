#!/usr/bin/env python
# coding: utf-8
from __future__ import unicode_literals

# Allow direct execution
import os
import sys
import unittest
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from yt_dlp.longname import (
    split_longname_str,
    combine_longname_str,
)


# TODO: add downloader testcase for "-fw_4mVz-44"
# ãã‚Œãã‚Œã‚‚ä½“èª¿ã«æ°—ã‚’ã¤ã‚±ãƒ†ğŸ˜³âœ‹ğŸ¤‘ï¼ˆï¿£â–½ï¿£ï¼‰YouTubeã¡ã‚ƒã‚“ğŸ˜†ğŸ˜ƒâ˜€ â—ğŸ˜šå…ƒæ°—ã€ãªã„ã®ã‹ãªã‚¡ğŸ˜­ğŸ˜“(T_T)ğŸ’¦å¤§ä¸ˆå¤«â“ï¼ˆï¿£ãƒ¼ï¿£?ï¼‰ğŸ˜œâ‰ï¸ğŸ¤”ãã‚Œãã‚Œã‚‚ä½“èª¿ã«æ°—ã‚’ã¤ã‚±ãƒ†ğŸ˜³âœ‹ğŸ¤‘ï¼ˆï¿£â–½ï¿£ï¼‰YouTubeã¡ã‚ƒã‚“ğŸ˜†
class TestLongName(unittest.TestCase):

    def test_split_utf8(self):
        self.assertEqual(
            split_longname_str('spade', 'utf8'),
            'spade'
        )
        self.assertEqual(
            split_longname_str('ã€å¦–æ€ªã‚¦ã‚©ãƒƒãƒã‚¢ãƒ‹ãƒ¡ã€‘ç¬¬ï¼‘ï¼“è©±ã€Œ ã‚³ãƒã•ã‚“ ã€œã¯ã˜ã‚ã¦ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ç·¨ã€œï¼ˆ#5ï¼‰ã€ã€Œå¦–æ€ª å£ã ã‘ãŠã‚“ãªã€  ã€Œå¦–æ€ª ãƒ€ãƒ³ã‚µãƒ¼ã‚ºâ˜†ã€ã€Œ ã˜ã‚“ã‚ã‚“çŠ¬ã‚·ãƒ¼ã‚ºãƒ³2 çŠ¬è„±èµ° Episode 2ã€-cL46Bl96_GQ.f137.mp4.part', 'utf8'),
            'ã€å¦–æ€ªã‚¦ã‚©ãƒƒãƒã‚¢ãƒ‹ãƒ¡ã€‘ç¬¬ï¼‘ï¼“è©±ã€Œ ã‚³ãƒã•ã‚“ ã€œã¯ã˜ã‚ã¦ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ç·¨ã€œï¼ˆ#5ï¼‰ã€ã€Œå¦–æ€ª å£ã ã‘ãŠã‚“ãªã€  ã€Œå¦–æ€ª ãƒ€ãƒ³ã‚µãƒ¼ã‚ºâ˜†ã€ã€Œ ã˜ã‚“ã‚ã‚“çŠ¬ã‚·ãƒ¼ã‚ºãƒ³2 çŠ¬è„±èµ° Episode 2ã€-cL46Bl96_GQ.f13~~/7.mp4.part'
        )

    def test_combine_utf8(self):
        self.assertEqual(
            combine_longname_str('spade', 'utf8'),
            'spade'
        )
        self.assertEqual(
            combine_longname_str('ã€å¦–æ€ªã‚¦ã‚©ãƒƒãƒã‚¢ãƒ‹ãƒ¡ã€‘ç¬¬ï¼‘ï¼“è©±ã€Œ ã‚³ãƒã•ã‚“ ã€œã¯ã˜ã‚ã¦ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ç·¨ã€œï¼ˆ#5ï¼‰ã€ã€Œå¦–æ€ª å£ã ã‘ãŠã‚“ãªã€  ã€Œå¦–æ€ª ãƒ€ãƒ³ã‚µãƒ¼ã‚ºâ˜†ã€ã€Œ ã˜ã‚“ã‚ã‚“çŠ¬ã‚·ãƒ¼ã‚ºãƒ³2 çŠ¬è„±èµ° Episode 2ã€-cL46Bl96_GQ.f13~~/7.mp4.part', 'utf8'),
            'ã€å¦–æ€ªã‚¦ã‚©ãƒƒãƒã‚¢ãƒ‹ãƒ¡ã€‘ç¬¬ï¼‘ï¼“è©±ã€Œ ã‚³ãƒã•ã‚“ ã€œã¯ã˜ã‚ã¦ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ç·¨ã€œï¼ˆ#5ï¼‰ã€ã€Œå¦–æ€ª å£ã ã‘ãŠã‚“ãªã€  ã€Œå¦–æ€ª ãƒ€ãƒ³ã‚µãƒ¼ã‚ºâ˜†ã€ã€Œ ã˜ã‚“ã‚ã‚“çŠ¬ã‚·ãƒ¼ã‚ºãƒ³2 çŠ¬è„±èµ° Episode 2ã€-cL46Bl96_GQ.f137.mp4.part'
        )

    def test_split_sjis(self):
        # In SJIS, it is in 255 bytes (!!)
        self.assertEqual(
            split_longname_str('ã€å¦–æ€ªã‚¦ã‚©ãƒƒãƒã‚¢ãƒ‹ãƒ¡ã€‘ç¬¬ï¼‘ï¼“è©±ã€Œ ã‚³ãƒã•ã‚“ ã€œã¯ã˜ã‚ã¦ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ç·¨ã€œï¼ˆ#5ï¼‰ã€ã€Œå¦–æ€ª å£ã ã‘ãŠã‚“ãªã€  ã€Œå¦–æ€ª ãƒ€ãƒ³ã‚µãƒ¼ã‚ºâ˜†ã€ã€Œ ã˜ã‚“ã‚ã‚“çŠ¬ã‚·ãƒ¼ã‚ºãƒ³2 çŠ¬è„±èµ° Episode 2ã€-cL46Bl96_GQ.f137.mp4.part', 'sjis'),
            'ã€å¦–æ€ªã‚¦ã‚©ãƒƒãƒã‚¢ãƒ‹ãƒ¡ã€‘ç¬¬ï¼‘ï¼“è©±ã€Œ ã‚³ãƒã•ã‚“ ã€œã¯ã˜ã‚ã¦ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ç·¨ã€œï¼ˆ#5ï¼‰ã€ã€Œå¦–æ€ª å£ã ã‘ãŠã‚“ãªã€  ã€Œå¦–æ€ª ãƒ€ãƒ³ã‚µãƒ¼ã‚ºâ˜†ã€ã€Œ ã˜ã‚“ã‚ã‚“çŠ¬ã‚·ãƒ¼ã‚ºãƒ³2 çŠ¬è„±èµ° Episode 2ã€-cL46Bl96_GQ.f137.mp4.part'
        )

    def test_resplit_identical(self):
        instr = 'ã€å¦–æ€ªã‚¦ã‚©ãƒƒãƒã‚¢ãƒ‹ãƒ¡ã€‘ç¬¬ï¼‘ï¼“è©±ã€Œ ã‚³ãƒã•ã‚“ ã€œã¯ã˜ã‚ã¦ã®ãƒ•ã‚¡ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰ç·¨ã€œï¼ˆ#5ï¼‰ã€ã€Œå¦–æ€ª å£ã ã‘ãŠã‚“ãªã€  ã€Œå¦–æ€ª ãƒ€ãƒ³ã‚µãƒ¼ã‚ºâ˜†ã€ã€Œ ã˜ã‚“ã‚ã‚“çŠ¬ã‚·ãƒ¼ã‚ºãƒ³2 çŠ¬è„±èµ° Episode 2ã€-cL46Bl96_GQ.f13~~/7.mp4.part'
        self.assertEqual(split_longname_str(instr, 'utf8'), instr)
